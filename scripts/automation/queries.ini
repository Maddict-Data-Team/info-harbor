[Setup]
radius_query = SELECT 
    distinct(radius)
    FROM {project}.{footfall_dataset}.{code_name}_POIs

countries_query = SELECT 
    distinct(country)
    FROM {project}.{metadata_dataset}.{campaign_tracker}
    WHERE code_name = {code_names}

[Retail]
queries = visitors,employee_vs_visitor,SocioEco,Behavior,HG,Travel_Distance,Travel_Distance_KM,Dwell_Time,Loyalist_Vs_Onetime,device_os

visitors=SELECT
    ls.did,
    ls.Local_Day,
    ls.Timestamp,
    ls.Local_Hour,
    ls.Longitude,
    ls.latitude,
    ls.Local_time,
    poi.POI_ID,
    0 as Data_filter,
    0 as Device_os_id,
    ls.Device_OS
    FROM
    `{project}.{location_signals_dataset}.{country}_Data` AS ls
    JOIN
    `{project}.{footfall_dataset}.{codename}_pois` AS poi
    ON
    ST_DISTANCE(ST_GEOGPOINT(ls.Longitude,ls.latitude),ST_GEOGPOINT(poi.longitude,poi.latitude))<{radius}
    WHERE
    ls.timestamp Between {start_date} AND {end_date}
    AND poi.Country={country_id}
        
device_os = Select distinct did, Device_os_id
    from {project}.{location_signals_dataset}.{device_os_mapping_table}
    where did in {project}.{footfall_dataset}.{codename}_visitors

home_graph = Select * 
    from `{project}.{hg_dataset}.{hg_table}`
    where did in (select distinct(did) from {project}.{footfall_dataset}.{codename}_visitors)

travel_distance = SELECT
    distinct(hg.DID),
    ST_DISTANCE(ST_GEOGPOINT(vis.longitude,vis.latitude),ST_GEOGPOINT(hg.long1,hg.lat1)) AS travel_distance
    FROM `{project}.{footfall_dataset}.{codename}_home_graph` AS hg
    JOIN `{project}.{footfall_dataset}.{codename}_visitors` AS vis
    ON vis.did = hg.did
    

[Campaign]
queries = visitors,footfall


[Placelift]
queries = visitors,footfall

